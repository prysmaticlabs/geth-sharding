syntax = "proto3";

package ethereum.beacon.p2p.v1;

import "proto/common/messages.proto";
import "github.com/gogo/protobuf/gogoproto/gogo.proto";

message BeaconState {
  // Miscellaneous [1001-2000]
  uint64 genesis_time = 1001;
  Fork fork = 1002;
  uint64 slot = 1003;

  // Validator registry [2001-3000]
  repeated Validator validator_registry = 2001;
  // Balances in Gwei
  repeated uint64 balances = 2002;

  // Randomness and committees [3001-4000]
  repeated bytes latest_randao_mixes = 3001 [(gogoproto.moretags) = "ssz:\"size=64,32\""];
  uint64 latest_start_shard = 3002;

  // Finality [4001-5000]
  repeated PendingAttestation previous_epoch_attestations = 4001;
  repeated PendingAttestation current_epoch_attestations = 4002;
  uint64 previous_justified_epoch = 4003;
  uint64 current_justified_epoch = 4004;
  bytes previous_justified_root = 4005 [(gogoproto.moretags) = "ssz:\"size=32\""];
  bytes current_justified_root = 4006 [(gogoproto.moretags) = "ssz:\"size=32\""];
  uint64 justification_bitfield = 4007;
  uint64 finalized_epoch = 4008;
  bytes finalized_root = 4009 [(gogoproto.moretags) = "ssz:\"size=32\""];

  // Recent state [5001-6000]
  repeated Crosslink current_crosslinks = 5001;
  repeated Crosslink previous_crosslinks = 5002;
  repeated bytes latest_block_roots = 5003 [(gogoproto.moretags) = "ssz:\"size=64,32\""];
  repeated bytes latest_state_roots = 5004 [(gogoproto.moretags) = "ssz:\"size=64,32\""];
  repeated bytes latest_active_index_roots = 5005 [(gogoproto.moretags) = "ssz:\"size=64,32\""];
  repeated uint64 latest_slashed_balances = 5006 [(gogoproto.moretags) = "ssz:\"size=64\""];
  BeaconBlockHeader latest_block_header = 5007;
  repeated bytes historical_roots = 5008 [(gogoproto.moretags) = "ssz:\"size=?,32\""];

  // Ethereum 1.0 chain data [6001-7000]
  Eth1Data latest_eth1_data = 6001;
  repeated Eth1Data eth1_data_votes = 6002;
  uint64 deposit_index = 6003;
}

message Fork {
  bytes previous_version = 1 [(gogoproto.moretags) = "ssz:\"size=4\""];
  bytes current_version = 2 [(gogoproto.moretags) = "ssz:\"size=4\""];
  uint64 epoch = 3;
}

message PendingAttestation {
  bytes aggregation_bitfield = 1;
  AttestationData data = 2;
  uint64 inclusion_delay = 3;
  uint64 proposer_index = 4;
}

message Attestation {
  bytes aggregation_bitfield = 1;
  AttestationData data = 2;
  bytes custody_bitfield = 3;
  bytes signature = 4 [(gogoproto.moretags) = "ssz:\"size=96\""];
}

message AttestationData {
  // LMD GHOST vote
  bytes beacon_block_root = 1 [(gogoproto.moretags) = "ssz:\"size=32\""];

  // FFG vote
  uint64 source_epoch = 2;
  bytes source_root = 3 [(gogoproto.moretags) = "ssz:\"size=32\""];
  uint64 target_epoch = 4;
  bytes target_root = 5 [(gogoproto.moretags) = "ssz:\"size=32\""];

  // Crosslink vote
  Crosslink crosslink = 6;
}

message AttestationTarget {
  uint64 slot = 1;
  bytes block_root = 2 [(gogoproto.moretags) = "ssz:\"size=32\""];
  bytes parent_root = 3 [(gogoproto.moretags) = "ssz:\"size=32\""];
}

message AttestationDataAndCustodyBit {
  AttestationData data = 1;
  bool custody_bit = 2;
}

message IndexedAttestation {
  // Validator indices
  repeated uint64 custody_bit_0_indices = 1;
  repeated uint64 custody_bit_1_indices = 2;
  AttestationData data = 3;
  // Aggregate signature
  bytes signature = 4 [(gogoproto.moretags) = "ssz:\"size=96\""];
}

message Validator {
  bytes pubkey = 1 [(gogoproto.moretags) = "ssz:\"size=48\""];
  bytes withdrawal_credentials = 2[(gogoproto.moretags) = "ssz:\"size=32\""];
  // Epoch when became eligible for activation
  uint64 activation_eligibility_epoch = 3;
  // Epoch when validator activated
  uint64 activation_epoch = 4;
  // Epoch when validator exited
  uint64 exit_epoch = 5;
  // Epoch when validator is eligible to withdraw
  uint64 withdrawable_epoch = 6;
  // Was the validator slashed
  bool slashed = 7;
  // Effective balance
  uint64 effective_balance = 8;
}

message ShardReassignmentRecord {
  uint64 validator_index = 1;
  uint64 shard = 2;
  uint64 slot = 3;
}

message Crosslink {
  uint64 shard = 1;
  uint64 start_epoch = 2;
  uint64 end_epoch = 3;
  bytes parent_root = 4 [(gogoproto.moretags) = "ssz:\"size=32\""];
  bytes data_root = 5 [(gogoproto.moretags) = "ssz:\"size=32\""];
}

message BeaconBlockHeader {
  uint64 slot = 1;
  bytes parent_root = 2 [(gogoproto.moretags) = "ssz:\"size=32\""];
  bytes state_root = 3 [(gogoproto.moretags) = "ssz:\"size=32\""];
  bytes body_root = 4 [(gogoproto.moretags) = "ssz:\"size=32\""];
  bytes signature = 5 [(gogoproto.moretags) = "ssz:\"size=96\""];
}

message BeaconBlock {
  uint64 slot = 1;
  bytes parent_root = 2 [(gogoproto.moretags) = "ssz:\"size=32\""];
  bytes state_root = 3 [(gogoproto.moretags) = "ssz:\"size=32\""];
  BeaconBlockBody body = 4;
  bytes signature = 5 [(gogoproto.moretags) = "ssz:\"size=96\""];
}

message BeaconBlockBody {
  bytes randao_reveal = 1 [(gogoproto.moretags) = "ssz:\"size=96\""];
  Eth1Data eth1_data = 2;
  bytes graffiti = 3 [(gogoproto.moretags) = "ssz:\"size=32\""];
  repeated Attestation attestations = 4;
  repeated ProposerSlashing proposer_slashings  = 5;
  repeated AttesterSlashing attester_slashings = 6;
  repeated Deposit deposits = 7;
  repeated VoluntaryExit voluntary_exits = 8;
  repeated Transfer transfers = 9;
}

message SlashableAttestation {
  repeated uint64 validator_indices = 1;
  bytes custody_bitfield = 2;
  AttestationData data = 3;
  bytes signature = 4 [(gogoproto.moretags) = "ssz:\"size=96\""];
}

message DepositData {
  bytes pubkey = 1 [(gogoproto.moretags) = "ssz:\"size=48\""];
  bytes withdrawal_credentials = 2 [(gogoproto.moretags) = "ssz:\"size=32\""];
  // Amount in Gwei
  uint64 amount = 3;
  bytes signature = 4 [(gogoproto.moretags) = "ssz:\"size=96\""];
}

message ProposerSlashing {
  uint64 proposer_index = 1;
  BeaconBlockHeader header_1 = 2;
  BeaconBlockHeader header_2 = 3;
}

message AttesterSlashing {
  IndexedAttestation attestation_1 = 1;
  IndexedAttestation attestation_2 = 2;
}

message Deposit {
  // Branch in the deposit tree
  repeated bytes proof = 1;
  DepositData data = 2;
}

message VoluntaryExit {
  // Minimum epoch for processing exit
  uint64 epoch = 1;
  uint64 validator_index = 2;
  bytes signature = 3 [(gogoproto.moretags) = "ssz:\"size=96\""];
}

message Transfer {
  uint64 sender = 1;
  uint64 recipient = 2;
  // Amount in Gwei
  uint64 amount = 3;
  // Fee in Gwei for block proposer
  uint64 fee = 4;
  // Inclusion slot
  uint64 slot = 5;
  // Sender withdrawal pubkey and signature
  bytes pubkey = 6 [(gogoproto.moretags) = "ssz:\"size=48\""];
  // Sender signature
  bytes signature = 7 [(gogoproto.moretags) = "ssz:\"size=96\""];
}

message Eth1Data {
  // Root of the deposit tree
  bytes deposit_root = 1 [(gogoproto.moretags) = "ssz:\"size=32\""];
  // Total number of deposits
  uint64 deposit_count = 2;
  // Block hash
  bytes block_hash = 3 [(gogoproto.moretags) = "ssz:\"size=32\""];
}

message Eth1DataVote {
  Eth1Data eth1_data = 1;
  uint64 vote_count = 2;
}

message HistoricalBatch {
  repeated bytes block_roots = 1 [(gogoproto.moretags) = "ssz:\"size=64,32\""];
  repeated bytes state_roots = 2 [(gogoproto.moretags) = "ssz:\"size=64,32\""];
}
